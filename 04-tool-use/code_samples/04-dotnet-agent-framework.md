# ğŸ› ï¸ ä½¿ç”¨ GitHub Models å®ç°é«˜çº§å·¥å…·è°ƒç”¨ (.NET)

## ğŸ“‹ å­¦ä¹ ç›®æ ‡

æœ¬æ•™ç¨‹æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Microsoft Agent Framework for .NET ä¸ GitHub Models æ„å»ºä¼ä¸šçº§å·¥å…·é›†æˆæ¨¡å¼ã€‚ä½ å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨å¤šä¸ªä¸“ä¸šå·¥å…·æ„å»ºå¤æ‚çš„ä»£ç†ï¼Œå……åˆ†åˆ©ç”¨ C# çš„å¼ºç±»å‹å’Œ .NET çš„ä¼ä¸šçº§ç‰¹æ€§ã€‚

### ä½ å°†æŒæ¡çš„é«˜çº§å·¥å…·èƒ½åŠ›

- ğŸ”§ **å¤šå·¥å…·æ¶æ„**ï¼šæ„å»ºå…·æœ‰å¤šç§ä¸“ä¸šèƒ½åŠ›çš„ä»£ç†
- ğŸ¯ **ç±»å‹å®‰å…¨çš„å·¥å…·æ‰§è¡Œ**ï¼šåˆ©ç”¨ C# çš„ç¼–è¯‘æ—¶éªŒè¯
- ğŸ“Š **ä¼ä¸šå·¥å…·æ¨¡å¼**ï¼šç”Ÿäº§çº§å·¥å…·è®¾è®¡å’Œé”™è¯¯å¤„ç†
- ğŸ”— **å·¥å…·ç»„åˆ**ï¼šç»„åˆå·¥å…·ä»¥å®Œæˆå¤æ‚çš„ä¸šåŠ¡å·¥ä½œæµ

## ğŸ¯ .NET å·¥å…·æ¶æ„ä¼˜åŠ¿

### ä¼ä¸šçº§å·¥å…·ç‰¹æ€§

- **ç¼–è¯‘æ—¶éªŒè¯**ï¼šå¼ºç±»å‹ç¡®ä¿å·¥å…·å‚æ•°æ­£ç¡®
- **ä¾èµ–æ³¨å…¥**ï¼šIoC å®¹å™¨é›†æˆç”¨äºå·¥å…·ç®¡ç†
- **å¼‚æ­¥æ¨¡å¼**ï¼šæ­£ç¡®çš„èµ„æºç®¡ç†çš„éé˜»å¡å·¥å…·æ‰§è¡Œ
- **ç»“æ„åŒ–æ—¥å¿—**ï¼šå†…ç½®æ—¥å¿—é›†æˆç”¨äºå·¥å…·æ‰§è¡Œç›‘æ§

### ç”Ÿäº§å°±ç»ªæ¨¡å¼

- **å¼‚å¸¸å¤„ç†**ï¼šä½¿ç”¨ç±»å‹åŒ–å¼‚å¸¸çš„ç»¼åˆé”™è¯¯ç®¡ç†
- **èµ„æºç®¡ç†**ï¼šæ­£ç¡®çš„ disposal æ¨¡å¼å’Œå†…å­˜ç®¡ç†
- **æ€§èƒ½ç›‘æ§**ï¼šå†…ç½®æŒ‡æ ‡å’Œæ€§èƒ½è®¡æ•°å™¨
- **é…ç½®ç®¡ç†**ï¼šå¸¦éªŒè¯çš„ç±»å‹å®‰å…¨é…ç½®

## ğŸ”§ æŠ€æœ¯æ¶æ„

### æ ¸å¿ƒ .NET å·¥å…·ç»„ä»¶

- **Microsoft.Extensions.AI**ï¼šç»Ÿä¸€çš„å·¥å…·æŠ½è±¡å±‚
- **Microsoft.Agents.AI**ï¼šä¼ä¸šçº§å·¥å…·ç¼–æ’
- **GitHub Models é›†æˆ**ï¼šå¸¦è¿æ¥æ± çš„é«˜æ€§èƒ½ API å®¢æˆ·ç«¯

### å·¥å…·æ‰§è¡Œæµç¨‹

```mermaid
graph LR
    A[ç”¨æˆ·è¯·æ±‚] --> B[ä»£ç†åˆ†æ]
    B --> C[å·¥å…·é€‰æ‹©]
    C --> D[ç±»å‹éªŒè¯]
    B --> E[å‚æ•°ç»‘å®š]
    E --> F[å·¥å…·æ‰§è¡Œ]
    C --> F
    F --> G[ç»“æœå¤„ç†]
    D --> G
    G --> H[å“åº”]
```

## ğŸ› ï¸ å·¥å…·ç±»åˆ«ä¸æ¨¡å¼

### 1. **æ•°æ®å¤„ç†å·¥å…·**

- **è¾“å…¥éªŒè¯**ï¼šä½¿ç”¨æ•°æ®æ³¨è§£çš„å¼ºç±»å‹
- **è½¬æ¢æ“ä½œ**ï¼šç±»å‹å®‰å…¨çš„æ•°æ®è½¬æ¢å’Œæ ¼å¼åŒ–
- **ä¸šåŠ¡é€»è¾‘**ï¼šé¢†åŸŸç‰¹å®šçš„è®¡ç®—å’Œåˆ†æå·¥å…·
- **è¾“å‡ºæ ¼å¼åŒ–**ï¼šç»“æ„åŒ–å“åº”ç”Ÿæˆ

### 2. **é›†æˆå·¥å…·**

- **API è¿æ¥å™¨**ï¼šä½¿ç”¨ HttpClient çš„ RESTful æœåŠ¡é›†æˆ
- **æ•°æ®åº“å·¥å…·**ï¼šç”¨äºæ•°æ®è®¿é—®çš„ Entity Framework é›†æˆ
- **æ–‡ä»¶æ“ä½œ**ï¼šå¸¦éªŒè¯çš„å®‰å…¨æ–‡ä»¶ç³»ç»Ÿæ“ä½œ
- **å¤–éƒ¨æœåŠ¡**ï¼šç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆæ¨¡å¼

### 3. **å®ç”¨å·¥å…·**

- **æ–‡æœ¬å¤„ç†**ï¼šå­—ç¬¦ä¸²æ“ä½œå’Œæ ¼å¼åŒ–å·¥å…·
- **æ—¥æœŸ/æ—¶é—´æ“ä½œ**ï¼šæ–‡åŒ–æ„ŸçŸ¥çš„æ—¥æœŸ/æ—¶é—´è®¡ç®—
- **æ•°å­¦å·¥å…·**ï¼šç²¾ç¡®è®¡ç®—å’Œç»Ÿè®¡æ“ä½œ
- **éªŒè¯å·¥å…·**ï¼šä¸šåŠ¡è§„åˆ™éªŒè¯å’Œæ•°æ®éªŒè¯

å‡†å¤‡å¥½åœ¨ .NET ä¸­æ„å»ºå…·æœ‰å¼ºå¤§ã€ç±»å‹å®‰å…¨å·¥å…·èƒ½åŠ›çš„ä¼ä¸šçº§ä»£ç†äº†å—ï¼Ÿè®©æˆ‘ä»¬æ¥è®¾è®¡ä¸€äº›ä¸“ä¸šçº§çš„è§£å†³æ–¹æ¡ˆï¼ğŸ¢âš¡

## ğŸš€ å…¥é—¨

### å‰ç½®æ¡ä»¶

- [.NET 10 SDK](https://dotnet.microsoft.com/download/dotnet/10.0) æˆ–æ›´é«˜ç‰ˆæœ¬
- [GitHub Models API è®¿é—®ä»¤ç‰Œ](https://docs.github.com/github-models/github-models-at-scale/using-your-own-api-keys-in-github-models)

### æ‰€éœ€ç¯å¢ƒå˜é‡

```bash
# zsh/bash
export GH_TOKEN=<your_github_token>
export GH_ENDPOINT=https://models.github.ai/inference
export GH_MODEL_ID=openai/gpt-5-mini
```

```powershell
# PowerShell
$env:GH_TOKEN = "<your_github_token>"
$env:GH_ENDPOINT = "https://models.github.ai/inference"
$env:GH_MODEL_ID = "openai/gpt-5-mini"
```

### ç¤ºä¾‹ä»£ç 

è¿è¡Œä»£ç ç¤ºä¾‹ï¼š

```bash
# zsh/bash
chmod +x ./04-dotnet-agent-framework.cs
./04-dotnet-agent-framework.cs
```

æˆ–ä½¿ç”¨ dotnet CLIï¼š

```bash
dotnet run ./04-dotnet-agent-framework.cs
```

æŸ¥çœ‹ [`04-dotnet-agent-framework.cs`](./04-dotnet-agent-framework.cs) è·å–å®Œæ•´ä»£ç ã€‚

```csharp
#!/usr/bin/dotnet run

#:package Microsoft.Extensions.AI@10.*
#:package Microsoft.Agents.AI.OpenAI@1.*-*

using System.ClientModel;
using System.ComponentModel;

using Microsoft.Agents.AI;
using Microsoft.Extensions.AI;

using OpenAI;

// å·¥å…·å‡½æ•°ï¼šéšæœºç›®çš„åœ°ç”Ÿæˆå™¨
// è¿™ä¸ªé™æ€æ–¹æ³•å°†ä½œä¸ºå¯è°ƒç”¨å·¥å…·æä¾›ç»™ä»£ç†
// [Description] å±æ€§å¸®åŠ© AI ç†è§£ä½•æ—¶ä½¿ç”¨æ­¤å‡½æ•°
// è¿™å±•ç¤ºäº†å¦‚ä½•ä¸º AI ä»£ç†åˆ›å»ºè‡ªå®šä¹‰å·¥å…·
[Description("æä¾›ä¸€ä¸ªéšæœºåº¦å‡ç›®çš„åœ°ã€‚")]
static string GetRandomDestination()
{
    // å…¨çƒçƒ­é—¨åº¦å‡ç›®çš„åœ°åˆ—è¡¨
    // ä»£ç†å°†éšæœºé€‰æ‹©è¿™äº›é€‰é¡¹
    var destinations = new List<string>
    {
        "æ³•å›½å·´é»",
        "æ—¥æœ¬ä¸œäº¬",
        "ç¾å›½çº½çº¦",
        "æ¾³å¤§åˆ©äºšæ‚‰å°¼",
        "æ„å¤§åˆ©ç½—é©¬",
        "è¥¿ç­ç‰™å·´å¡ç½—é‚£",
        "å—éå¼€æ™®æ•¦",
        "å·´è¥¿é‡Œçº¦çƒ­å†…å¢",
        "æ³°å›½æ›¼è°·",
        "åŠ æ‹¿å¤§æ¸©å“¥å"
    };

    // ç”Ÿæˆéšæœºç´¢å¼•å¹¶è¿”å›é€‰ä¸­çš„ç›®çš„åœ°
    // ä½¿ç”¨ System.Random è¿›è¡Œç®€å•éšæœºé€‰æ‹©
    var random = new Random();
    int index = random.Next(destinations.Count);
    return destinations[index];
}

// ä»ç¯å¢ƒå˜é‡æå–é…ç½®
// è·å– GitHub Models API ç«¯ç‚¹ï¼ŒæœªæŒ‡å®šæ—¶é»˜è®¤ä¸º https://models.github.ai/inference
// è·å–æ¨¡å‹ IDï¼ŒæœªæŒ‡å®šæ—¶é»˜è®¤ä¸º openai/gpt-5-mini
// è·å–ç”¨äºè®¤è¯çš„ GitHub ä»¤ç‰Œï¼ŒæœªæŒ‡å®šæ—¶æŠ›å‡ºå¼‚å¸¸
var github_endpoint = Environment.GetEnvironmentVariable("GH_ENDPOINT") ?? "https://models.github.ai/inference";
var github_model_id = Environment.GetEnvironmentVariable("GH_MODEL_ID") ?? "openai/gpt-5-mini";
var github_token = Environment.GetEnvironmentVariable("GH_TOKEN") ?? throw new InvalidOperationException("GH_TOKEN is not set.");

// é…ç½® OpenAI å®¢æˆ·ç«¯é€‰é¡¹
// åˆ›å»ºé…ç½®é€‰é¡¹ä»¥æŒ‡å‘ GitHub Models ç«¯ç‚¹
// è¿™ä¼šå°† OpenAI å®¢æˆ·ç«¯è°ƒç”¨é‡å®šå‘åˆ° GitHub çš„æ¨¡å‹æ¨ç†æœåŠ¡
var openAIOptions = new OpenAIClientOptions()
{
    Endpoint = new Uri(github_endpoint)
};

// ä½¿ç”¨ GitHub Models é…ç½®åˆå§‹åŒ– OpenAI å®¢æˆ·ç«¯
// ä½¿ç”¨ GitHub ä»¤ç‰Œè¿›è¡Œè®¤è¯åˆ›å»º OpenAI å®¢æˆ·ç«¯
// é…ç½®ä¸ºä½¿ç”¨ GitHub Models ç«¯ç‚¹è€Œéç›´æ¥ä½¿ç”¨ OpenAI
var openAIClient = new OpenAIClient(new ApiKeyCredential(github_token), openAIOptions);

// å®šä¹‰ä»£ç†èº«ä»½å’Œè¯¦ç»†æŒ‡ä»¤
// ç”¨äºè¯†åˆ«å’Œæ—¥å¿—è®°å½•çš„ä»£ç†åç§°
var AGENT_NAME = "TravelAgent";

// å®šä¹‰ä»£ç†ä¸ªæ€§ã€èƒ½åŠ›å’Œè¡Œä¸ºçš„è¯¦ç»†æŒ‡ä»¤
// æ­¤ç³»ç»Ÿæç¤ºå¡‘é€ äº†ä»£ç†å¦‚ä½•å“åº”å’Œä¸ç”¨æˆ·äº¤äº’
var AGENT_INSTRUCTIONS = """
ä½ æ˜¯ä¸€ä¸ªå¯ä»¥å¸®åŠ©å®¢æˆ·è§„åˆ’åº¦å‡çš„æœ‰ç”¨ AI ä»£ç†ã€‚

é‡è¦æç¤ºï¼šå½“ç”¨æˆ·æŒ‡å®šç›®çš„åœ°æ—¶ï¼Œå§‹ç»ˆä¸ºè¯¥åœ°ç‚¹è¿›è¡Œè§„åˆ’ã€‚åªæœ‰åœ¨ç”¨æˆ·æœªæŒ‡å®šåå¥½æ—¶æ‰å»ºè®®éšæœºç›®çš„åœ°ã€‚

å¯¹è¯å¼€å§‹æ—¶ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹æ¶ˆæ¯è¿›è¡Œè‡ªæˆ‘ä»‹ç»ï¼š
"ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„ TravelAgent åŠ©æ‰‹ã€‚æˆ‘å¯ä»¥å¸®åŠ©ä½ è§„åˆ’åº¦å‡å¹¶ä¸ºä½ æ¨èæœ‰è¶£çš„ç›®çš„åœ°ã€‚ä½ å¯ä»¥é—®æˆ‘ä»¥ä¸‹é—®é¢˜ï¼š
1. ä¸ºç‰¹å®šåœ°ç‚¹è§„åˆ’ä¸€æ—¥æ¸¸
2. æ¨èéšæœºåº¦å‡ç›®çš„åœ°
3. æŸ¥æ‰¾å…·æœ‰ç‰¹å®šç‰¹å¾çš„ç›®çš„åœ°ï¼ˆæµ·æ»©ã€å±±è„‰ã€å†å²é—è¿¹ç­‰ï¼‰
4. å¦‚æœä½ ä¸å–œæ¬¢æˆ‘çš„ç¬¬ä¸€ä¸ªå»ºè®®ï¼Œè§„åˆ’æ›¿ä»£è¡Œç¨‹

ä»Šå¤©ä½ æƒ³è®©æˆ‘å¸®ä½ è§„åˆ’ä»€ä¹ˆæ ·çš„æ—…è¡Œï¼Ÿ"

å§‹ç»ˆä¼˜å…ˆè€ƒè™‘ç”¨æˆ·åå¥½ã€‚å¦‚æœä»–ä»¬æåˆ°ç‰¹å®šç›®çš„åœ°å¦‚"å·´å˜å²›"æˆ–"å·´é»"ï¼Œè¯·ä¸“æ³¨äºä¸ºè¯¥åœ°ç‚¹è¿›è¡Œè§„åˆ’ï¼Œè€Œä¸æ˜¯å»ºè®®æ›¿ä»£æ–¹æ¡ˆã€‚
""";

// åˆ›å»ºå…·æœ‰é«˜çº§æ—…è¡Œè§„åˆ’åŠŸèƒ½çš„ AI ä»£ç†
// åˆå§‹åŒ–å®Œæ•´ä»£ç†ç®¡é“ï¼šOpenAI å®¢æˆ·ç«¯ â†’ èŠå¤©å®¢æˆ·ç«¯ â†’ AI ä»£ç†
// é…ç½®ä»£ç†åç§°ã€è¯¦ç»†æŒ‡ä»¤å’Œå¯ç”¨å·¥å…·
// è¿™å±•ç¤ºäº†å¸¦æœ‰å®Œæ•´é…ç½®çš„ .NET ä»£ç†åˆ›å»ºæ¨¡å¼
AIAgent agent = openAIClient
    .GetChatClient(github_model_id)
    .CreateAIAgent(
        name: AGENT_NAME,
        instructions: AGENT_INSTRUCTIONS,
        tools: [AIFunctionFactory.Create(GetRandomDestination)]
    );

// åˆ›å»ºæ–°å¯¹è¯çº¿ç¨‹ä»¥è¿›è¡Œä¸Šä¸‹æ–‡ç®¡ç†
// åˆå§‹åŒ–æ–°å¯¹è¯çº¿ç¨‹ä»¥åœ¨å¤šæ¬¡äº¤äº’ä¸­ç»´æŠ¤ä¸Šä¸‹æ–‡
// çº¿ç¨‹ä½¿ä»£ç†èƒ½å¤Ÿè®°ä½ä¹‹å‰çš„äº¤æ¢å¹¶ç»´æŠ¤å¯¹è¯çŠ¶æ€
// è¿™å¯¹äºå¤šè½®å¯¹è¯å’Œä¸Šä¸‹æ–‡ç†è§£è‡³å…³é‡è¦
AgentThread thread = agent.GetNewThread();

// æ‰§è¡Œä»£ç†ï¼šç¬¬ä¸€ä¸ªæ—…è¡Œè§„åˆ’è¯·æ±‚
// ä½¿ç”¨å¯èƒ½è§¦å‘éšæœºç›®çš„åœ°å·¥å…·çš„åˆå§‹è¯·æ±‚è¿è¡Œä»£ç†
// ä»£ç†å°†åˆ†æè¯·æ±‚ï¼Œä½¿ç”¨ GetRandomDestination å·¥å…·ï¼Œå¹¶åˆ›å»ºè¡Œç¨‹
// ä½¿ç”¨ thread å‚æ•°ç»´æŠ¤åç»­äº¤äº’çš„å¯¹è¯ä¸Šä¸‹æ–‡
await foreach (var update in agent.RunStreamingAsync("å¸®æˆ‘è§„åˆ’ä¸€æ—¥æ¸¸", thread))
{
    await Task.Delay(10);
    Console.Write(update);
}

Console.WriteLine();

// æ‰§è¡Œä»£ç†ï¼šå¸¦æœ‰ä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„åç»­è¯·æ±‚
// é€šè¿‡å¼•ç”¨ä¹‹å‰çš„å“åº”å±•ç¤ºä¸Šä¸‹æ–‡å¯¹è¯
// ä»£ç†ä¼šè®°ä½ä¹‹å‰çš„ç›®çš„åœ°å»ºè®®å¹¶æä¾›æ›¿ä»£æ–¹æ¡ˆ
// è¿™å±•ç¤ºäº† .NET ä»£ç†ä¸­å¯¹è¯çº¿ç¨‹å’Œä¸Šä¸‹æ–‡ç†è§£çš„åŠ›é‡
await foreach (var update in agent.RunStreamingAsync("æˆ‘ä¸å–œæ¬¢é‚£ä¸ªç›®çš„åœ°ã€‚å¸®æˆ‘è§„åˆ’å¦ä¸€ä¸ªåº¦å‡è¡Œç¨‹ã€‚", thread))
{
    await Task.Delay(10);
    Console.Write(update);
}
```
